<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">
<body>

<metal:content-core fill-slot="main">
    <metal:content-core define-macro="content-core"
                        tal:define="kssClassesView context/@@kss_field_decorator_view;
                                    getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                                    templateId string:@@player-view;
                                    toLocalizedTime nocall:context/@@plone/toLocalizedTime;
                                    server context/server;
                                    failed context/autoUpdateData;
                                    charname context/title">
      <div tal:condition="failed">
        Character not found!
      </div>
      
      <div tal:condition="not:failed">
        <h1 tal:condition="context/guild" tal:content="string:${context/Title} <${context/guild}>"/>
        <h1 tal:condition="not:context/guild" tal:content="string:${context/Title}"/>
        <div metal:use-macro="here/gear_macro/macros/char_header" />
        
        <div>
          <div class="wowcharinfo">
            <table class="vertical listing">
  						<tr>
  							<th>Armory link</th>
  							<td>
  							  <a tal:content="string:http://us.battle.net/wow/en/character/${server}/${charname}/advanced"
  							     tal:attributes="href string:http://us.battle.net/wow/en/character/${server}/${charname}/advanced"/>
  							</td>
  						</tr>
  						<tr tal:condition="context/guild">
  							<th>Guild</th>
  							<td>
  							  <a tal:content="string:http://us.battle.net/wow/en/guild/${server}/${context/guild}/"
  							     tal:attributes="href string:http://us.battle.net/wow/en/guild/${server}/${context/guild}/"/>
  						</tr>
  						<tr>
  						  <th>WowWProgress</th>
  						  <td><a tal:attributes="href string:http://www.wowprogress.com/character/us/${server}/${charname}"
  						         tal:content="string:http://www.wowprogress.com/character/us/${server}/${charname}"/>
  						  </td>
  						</tr>
  						<tr>
  						  <th>epeen bot</th>
  						  <td><a tal:attributes="href string:http://raidbots.com/epeenbot/us/${server}/${charname}"
  						         tal:content="string:http://raidbots.com/epeenbot/us/${server}/${charname}"/>
  						  </td>
  						</tr>
  						<tr>
  							<th>Item Level</th>
  							<td>
  							  <table>
  							    <tr>
  							      <td>Total:</td>
  							      <td tal:content="context/averageItemLevel"/>
  							    </tr>
  							    <tr>
  							      <td>Equipped:</td>
  							      <td tal:content="context/averageItemLevelEquipped"/>
  							    </tr>
  							  </table>
  							</td>
  						</tr>
  						<tr>
  							<th>Server</th>
  							<td tal:content="context/serverTitle" />
  						</tr>
  						<tr>
  							<th>Class</th>
  							<td tal:content="context/klass|string:"/>
  						</tr>
  						<tr>
  							<th>Race</th>
  							<td tal:content="context/race|string:"/>
  						</tr>
  						<tr>
  						  <th>Gender</th>
  						  <td tal:content="context/gender|string:"/>
  						</tr>
  						<tr>
  						  <th>Level</th>
  						  <td tal:content="context/level|string:"/>
  						</tr>
  						<tr>
  						  <th>Titles</th>
  						  <td tal:content="context/titles"/>
  						</tr>
  						<tr>
  						  <th>Pets (unique)</th>
  						  <td>
  						    <a tal:attributes="href string:${context/absolute_url}/@@pets-view">
  						      <img tal:attributes="src string:${portal_url}/++resource++esoth.wow/beast.png"/>
  						      <span tal:content="context/numcompanions"/> (click for more details)
  						    </a>
  						  </td>
  						</tr>
  						<tr>
  						  <th>Mounts</th>
  						  <td tal:content="context/mounts"/>
  						</tr>
            </table>
          </div>
  
          <div class="avatarFrame">
            <div tal:condition="context/avatar">
              <img tal:define="scale context/@@images;
                               img python:scale.scale('avatar',scale='thumb')"
                   tal:replace="structure python:img and img.tag()" /><br/>
            </div>
            <span tal:content="context/points"/> achievement points.
              
            <div tal:condition="python:len(context.specs)>0">
              <h3>Main Spec: <span tal:content="python:context.specs[0]['name']"/></h3>
              <ul class="visualNoMarker">
                <tal:talent repeat="talent context/mainTalents">
                  <li>
                    <span tal:content="python:(int(talent['tier'])+1)*15"/>:
                    <img tal:attributes="src string:http://wow.zamimg.com/images/wow/icons/small/${talent/icon}.jpg"/>
                    <a tal:attributes="href string:http://www.wowhead.com?spell=${talent/id}"
                       tal:content="talent/name"/>
                  </li>
                </tal:talent>
              </ul>
            </div>
              
            <div tal:condition="python:len(context.specs)>1 and context.specs[1].has_key('name')">
              <h3>Second Spec: <span tal:content="python:context.specs[1]['name']"/></h3>
              <ul class="visualNoMarker">
                <tal:talent repeat="talent context/secondTalents">
                  <li>
                    <span tal:content="python:(int(talent['tier'])+1)*15"/>:
                    <img tal:attributes="src string:http://wow.zamimg.com/images/wow/icons/small/${talent/icon}.jpg"/>
                    <a tal:attributes="href string:http://www.wowhead.com?spell=${talent/id}"
                       tal:content="talent/name"/>
                  </li>
                </tal:talent>
              </ul>
            </div>
            
          </div>
          
         <h2>Stats</h2>
          <table class="listing verticle">
            <tr tal:condition="python:int(context.agility) > int(context.intellect) and int(context.agility) > int(context.strength)">
              <th>Agility</th>
              <td tal:content="context/agility|string:;"/>
              <th>Stamina</th>
              <td tal:content="context/stamina|string:;"/>
            </tr>
            <tr tal:condition="python:int(context.strength) > int(context.agility) and int(context.strength) > int(context.intellect)">
              <th>Strength</th>
              <td tal:content="context/strength|string:;"/>
              <th>Stamina</th>
              <td tal:content="context/stamina|string:;"/>
            </tr>
            <tr tal:condition="python:int(context.intellect) > int(context.agility) and int(context.intellect) > int(context.agility)">
              <th>Intellect</th>
              <td tal:content="context/intellect|string:;"/>
              <th>Stamina</th>
              <td tal:content="context/stamina|string:;"/>
            </tr>
            <tr>
              <th>Hit</th>
              <td tal:content="context/hit|string:;"/>
              <th>Crit</th>
              <td tal:content="context/crit|string:;"/>
            </tr>
            <tr>
              <th>Haste</th>
              <td tal:content="context/haste|string:;"/>
              <th>Mastery</th>
              <td tal:content="context/mastery|string:;"/>
            </tr>
            <tr tal:condition="python:int(context.spirit)>500">
              <th>Spirit</th>
              <td tal:content="context/spirit|string:;"/>
              <th/><td/>
            </tr>
          </table>
          <div class="visualClear"> </div>
          
          <h2>Progression</h2>
          <tal:tier repeat="tier context/progressionDisplay">
            <h3 tal:content="tier/tier"/>
            <tal:raid repeat="raid tier/raids">
              <table class="progressionTable">
                <thead>
                  <tr>
                    <th class="raidName" tal:attributes="colspan python:len(raid['bosses'])" tal:content="raid/raid"/>
                  </tr>
                  <tr>
                    <tal:bosses repeat="boss raid/bosses">
                      <th tal:content="boss/name"/>
                    </tal:bosses>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <tal:boss repeat="boss raid/bosses">
                      <td tal:attributes="class python:int(boss['hkills'])>0 and 'killed' or 'notKilled'">
                        <span tal:content="string:${boss/hkills} heroic kill(s)"/><br/>
                        <span tal:content="string:${boss/nkills} normal kill(s)"/>
                      </td>
                    </tal:boss>
                  </tr>
                </tbody>
              </table>
            </tal:raid>
          </tal:tier>
          
        </div>
      </div>

    </metal:content-core>
</metal:content-core>

</body>
</html>